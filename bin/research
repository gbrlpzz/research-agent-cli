#!/bin/bash
# Research CLI - paper discovery and citation management

REPO_ROOT="$HOME/Documents/GitHub/research-agent-cli"
VENV="$REPO_ROOT/.venv"
PYTHON="$VENV/bin/python"

# Show usage if no args
if [ -z "$1" ]; then
    echo "Usage:"
    echo "  research <query>              Unified multi-source search (S2 + paper-scraper)"
    echo "  research agent <topic>        Autonomous research agent (produces Typst docs)"
    echo "  research exa <query>          Semantic search with Exa.ai (costs credits)"
    echo "  research edison <query>       AI literature synthesis (costs 1 credit)"
    echo "  research edison list          Browse past Edison reports"
    echo "  research edison show <id>     View specific report"
    echo "  research edison cache <query> Check if query cached"
    echo "  research edison credits       Show credit balance"
    echo "  research add [id]             Quick add from DOI/arXiv (or clipboard)"
    echo "  research cite [query]         Search library and copy citation keys"
    echo "  research open [query]         Search library and open paper in browser"
    echo "  research qa <question>        Ask questions about your library (PaperQA RAG)"
    echo "  research help                 Show interactive tutorial with examples"
    echo ""
    echo "Examples:"
    echo "  research \"attention mechanism\"         # Find papers about attention"
    echo "  research agent \"impact of transformers\" # Full research report"
    echo "  research exa \"reasoning in LLMs\"       # Semantic search with Exa.ai"
    echo "  research edison \"few-shot learning\"   # AI synthesis (1 credit)"
    echo "  research add 10.1234/example           # Add paper by DOI"
    echo "  research cite egger                    # Find citations by Egger"
    echo "  research help                          # Interactive tutorial"
    exit 0
fi


# Handle subcommands
case "$1" in
    edison)
        shift
        # Check if first arg is a subcommand or a query
        if [ -z "$1" ]; then
            echo "Usage: research edison <query|list|show|cache|credits>"
            exit 1
        fi
        
        # Check if it's a subcommand (starts with no quotes, matches known commands)
        case "$1" in
            list)
                "$PYTHON" "$REPO_ROOT/scripts/edison_literature.py" --list
                ;;
            show)
                shift
                "$PYTHON" "$REPO_ROOT/scripts/edison_literature.py" --show "$@"
                ;;
            cache)
                shift
                "$PYTHON" "$REPO_ROOT/scripts/edison_literature.py" --cache "$@"
                ;;
            credits)
                "$PYTHON" "$REPO_ROOT/scripts/edison_literature.py" --credits
                ;;
            *)
                # Default: treat as query
                "$PYTHON" "$REPO_ROOT/scripts/edison_literature.py" "$@"
                ;;
        esac
        ;;
    exa)
        shift
        "$PYTHON" "$REPO_ROOT/scripts/exa_search.py" "$@"
        ;;
    agent)
        shift
        "$PYTHON" "$REPO_ROOT/scripts/agent.py" "$@"
        ;;
    add)
        shift
        "$PYTHON" "$REPO_ROOT/scripts/add.py" "$@"
        ;;
    cite)
        shift
        "$PYTHON" "$REPO_ROOT/scripts/cite.py" "$@"
        ;;
    open)
        shift
        "$PYTHON" "$REPO_ROOT/scripts/open.py" "$@"
        ;;
    qa)
        shift
        "$PYTHON" "$REPO_ROOT/scripts/qa.py" "$@"
        ;;
    help|--help|-h)
        "$PYTHON" "$REPO_ROOT/scripts/help.py"
        ;;
    *)
        # Default: search papers
        "$PYTHON" "$REPO_ROOT/scripts/discover.py" "$@"
        ;;
esac
